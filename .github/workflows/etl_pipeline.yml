name: Daily Automated ETL Pipeline

# This section acts as the "alarm clock"
on:
  schedule:
    - cron: '0 11 * * *' # Runs at 11:00 AM UTC (6:00 AM Chicago time) daily
  workflow_dispatch:     # This allows us to click a button to run it manually!

jobs:
  run-etl:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout Code
      uses: actions/checkout@v4

    - name: Setup Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.10'

    # --- UPDATED: Added pandas to the install list ---
    - name: Install Dependencies
      run: |
        python -m pip install --upgrade pip
        pip install pandas psycopg2-binary requests python-dotenv

    - name: Run Ticketmaster API Pipeline
      env:
        DB_HOST: ${{ secrets.DB_HOST }}
        DB_USER: ${{ secrets.DB_USER }}
        DB_PASSWORD: ${{ secrets.DB_PASSWORD }}
        TM_API_KEY: ${{ secrets.TM_API_KEY }}
      run: python ingest_ticketmaster.py

    - name: Run Museum API Pipeline
      env:
        DB_HOST: ${{ secrets.DB_HOST }}
        DB_USER: ${{ secrets.DB_USER }}
        DB_PASSWORD: ${{ secrets.DB_PASSWORD }}
      run: python ingest_museums.py

    # --- NEW: Added the Static Deals script ---
    - name: Run Static Deals Pipeline
      env:
        DB_HOST: ${{ secrets.DB_HOST }}
        DB_USER: ${{ secrets.DB_USER }}
        DB_PASSWORD: ${{ secrets.DB_PASSWORD }}
      run: python ingest_static_deals.py